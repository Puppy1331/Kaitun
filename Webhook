-- SendToWebhook.lua: Gửi dữ liệu account/seeds/unit godly tổng hợp lên Discord Webhook
local _wait = task.wait
repeat _wait() until game:IsLoaded()

local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local logicRoot = Player:WaitForChild("PlayerGui"):WaitForChild("LogicHolder")
local modulesDir = logicRoot:WaitForChild("ClientLoader"):WaitForChild("Modules")
local ClientDataHandler = require(modulesDir:WaitForChild("ClientDataHandler"))
local SharedItemData = require(modulesDir:WaitForChild("SharedItemData"))

local HttpService = game:GetService("HttpService")

-- Hàm gửi webhook Discord
local function SendToWebhook(url, data)
    local body = HttpService:JSONEncode(data)
    local headers = { ["Content-Type"] = "application/json" }

    if syn and syn.request then
        syn.request({
            Url = url,
            Method = "POST",
            Headers = headers,
            Body = body
        })
    elseif request then
        request({
            Url = url,
            Method = "POST",
            Headers = headers,
            Body = body
        })
    else
        warn("❌ Không tìm thấy syn.request hoặc request!")
    end
end

-- Hàm gom dữ liệu
local function collectAndSend()
    local inventory = ClientDataHandler.GetValue("Inventory")
    local godlyCount = 0
    local godlyNames = {}

    for _, unitData in pairs(inventory or {}) do
        local itemId = unitData.ItemData and unitData.ItemData.ID
        if itemId then
            local cfg = require(Player.PlayerGui.LogicHolder.ClientLoader.SharedConfig.ItemData.Units.Configs:FindFirstChild(itemId))
            if cfg and cfg.Rarity == "ra_godly"
                and itemId ~= "unit_fire_flower"
                and itemId ~= "unit_stun_flower"
                and itemId ~= "unit_zapper"
                and itemId ~= "unit_passionfruit"
                and itemId ~= "unit_banana" then
                godlyCount += 1
                table.insert(godlyNames, itemId)
            end
        end
    end

    -- Tổng hợp thành chuỗi tên
    local unitSummary = (#godlyNames > 0) and table.concat(godlyNames, ", ") or "Không có"

    -- Gửi dạng embed Discord
    local data = {
        username = "Roblox Account Logger",
        embeds = {{
            title = "📊 Account Info",
            color = 0x00ff99,
            fields = {
                { name = "👤 Account", value = Player.Name, inline = true },
                { name = "📅 Account Age", value = tostring(Player.AccountAge) .. " ngày", inline = true },
                { name = "🌱 Seeds", value = tostring(Player.leaderstats.Seeds.Value), inline = true },
                { name = "⭐ Godly Units", value = tostring(godlyCount), inline = true },
                { name = "📦 Tên Units", value = unitSummary, inline = false }
            },
            footer = { text = "Last update: " .. os.date("%Y-%m-%d %H:%M:%S") }
        }}
    }

    local url = "https://discord.com/api/webhooks/1366162408909045800/oiXJ-cxUjaBLBYwEC_hju0fBsFFMWQN6hcK32KHQdwEd6112kGI43cE4wxiK6TMkAhfA" -- 🔗 Đổi sang webhook Discord của bạn
    SendToWebhook(url, data)
end

-- Auto gửi mỗi 30s
while true do
    collectAndSend()
    task.wait(30)
end
